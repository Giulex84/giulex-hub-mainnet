<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Giulex Hub</title>
</head>
<body>
<h1>Giulex Hub</h1>

<button id="auth">Authenticate</button>
<button id="pay">Pay 1 Test-Pi</button>

<pre id="log"></pre>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
const log = (m) =>
  document.getElementById("log").textContent +=
  "\n" + (typeof m === "string" ? m : JSON.stringify(m, null, 2));

if (!window.Pi) {
  log("❌ Pi SDK NOT LOADED");
} else {
  log("✅ Pi SDK loaded");
}

Pi.init({ version: "2.0", sandbox: false });

document.getElementById("auth").onclick = async () => {
  const res = await Pi.authenticate(["username","payments"], () => {}, () => {});
  log(res);
};

document.getElementById("pay").onclick = () => {
  log("▶ pay() clicked");

  Pi.createPayment({
    amount: 1,
    memo: "Giulex Test Payment",
    metadata: { test: true },

    onReadyForServerApproval: async (paymentId) => {
      log("approve: " + paymentId);
      await fetch("/api/pi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "approve", paymentId }),
      });
    },

    onReadyForServerCompletion: async (paymentId, txid) => {
      log("complete: " + paymentId);
      await fetch("/api/pi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "complete", paymentId, txid }),
      });
    },

    onCancel: (e) => log("❌ canceled"),
    onError: (e) => log("❌ error " + JSON.stringify(e)),
  });
};
</script>
</body>
</html>
