<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Giulex Hub</title>
</head>
<body>
  <h1>Giulex Hub</h1>
  <button onclick="auth()">Authenticate</button>
  <button onclick="pay()">Pay 1 Test-Pi</button>
  <pre id="log"></pre>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
Pi.init({ version: "2.0", sandbox: false });

const log = (m) =>
  document.getElementById("log").textContent += "\n" + JSON.stringify(m, null, 2);

async function auth() {
  const res = await Pi.authenticate(["username", "payments"], () => {}, () => {});
  log(res);
}

async function pay() {
  Pi.createPayment({
    amount: 1,
    memo: "Giulex Test Payment",
    metadata: { app: "giulex-hub" },
    onReadyForServerApproval: async (paymentId) => {
      log({ approve: paymentId });
      await fetch("/api/pi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "approve", paymentId }),
      });
    },
    onReadyForServerCompletion: async (paymentId, txid) => {
      log({ complete: paymentId, txid });
      await fetch("/api/pi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "complete", paymentId, txid }),
      });
    },
    onCancel: (e) => log({ canceled: e }),
    onError: (e) => log({ error: e }),
  });
}
</script>
</body>
</html>
