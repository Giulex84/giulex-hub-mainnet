<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Giulex Hub – jr.pi</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { font-family: Arial; text-align: center; padding: 30px; }
    button { padding: 12px 20px; font-size: 16px; margin: 10px; }
    .box { margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    footer { margin-top: 50px; font-size: 14px; }
  </style>
</head>

<body>

<h1>Giulex Hub</h1>
<p>Official jr.pi Utility Hub</p>

<button id="loginBtn">Login with Pi</button>

<div id="app"></div>

<footer>
  <hr>
  <p>
    <a href="/privacy.html">Privacy Policy</a> |
    <a href="/terms.html">Terms of Service</a>
  </p>
</footer>

<script>
  Pi.init({ version: "2.0" });

  async function login() {
    try {
      const auth = await Pi.authenticate(
        ["username", "payments", "wallet_address"],
        onIncompletePaymentFound
      );

      document.getElementById("loginBtn").style.display = "none";

      document.getElementById("app").innerHTML = `
        <div class="box">
          <h2>Welcome ${auth.user.username}</h2>
          <p><strong>UID:</strong> ${auth.user.uid}</p>
          <p><strong>Wallet:</strong> ${auth.user.wallet_address}</p>
          <p>jr.pi domain is connected to Giulex Hub.</p>
          <button onclick="engage('${auth.user.uid}')">Confirm Engagement</button>
        </div>
      `;

    } catch (err) {
      alert("Login failed");
    }
  }

  async function engage(uid) {
    await fetch("/api/pi", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "engage",
        uid: uid
      })
    });

    alert("Engagement recorded ✔");
  }

  function onIncompletePaymentFound(payment) {
    console.log("Incomplete payment:", payment);
  }

  document.getElementById("loginBtn").addEventListener("click", login);
</script>

</body>
</html>
