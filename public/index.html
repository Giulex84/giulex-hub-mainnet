<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Giulex Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Pi Network SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a, #020617);
      color: white;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      width: 100%;
      max-width: 420px;
      padding: 24px;
      border-radius: 16px;
      background: rgba(255,255,255,0.05);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    button {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: #6366f1;
      color: white;
    }
    button.secondary {
      background: #334155;
    }
    pre {
      margin-top: 16px;
      font-size: 12px;
      white-space: pre-wrap;
      opacity: 0.85;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>Giulex Hub</h2>
    <p id="status">Initializing Pi SDK…</p>

    <button onclick="login()">Authenticate</button>
    <button class="secondary" onclick="pay()">Test Payment</button>

    <pre id="log"></pre>
  </div>

  <script>
    const log = (msg) => {
      document.getElementById("log").textContent += msg + "\n";
    };

    // 1️⃣ INIT SDK — OBBLIGATORIO
    Pi.init({
      version: "2.0",
      sandbox: false
    });

    document.getElementById("status").textContent = "Pi SDK ready";

    // 2️⃣ AUTH
    async function login() {
      try {
        log("Authenticating...");
        const user = await Pi.authenticate(
          ["username", "payments"],
          () => log("Auth canceled"),
          (err) => log("Auth error: " + JSON.stringify(err))
        );
        log("User authenticated:");
        log(JSON.stringify(user, null, 2));
      } catch (e) {
        log("Auth exception: " + e.message);
      }
    }

    // 3️⃣ PAYMENT
    async function pay() {
      try {
        log("Creating payment...");
        const payment = await Pi.createPayment(
          {
            amount: 0.01,
            memo: "Giulex Hub Test Payment",
            metadata: { test: true }
          },
          {
            onReadyForServerApproval: (paymentId) => {
              log("Ready for approval: " + paymentId);
            },
            onReadyForServerCompletion: (paymentId, txid) => {
              log("Completed: " + paymentId + " tx: " + txid);
            },
            onCancel: (paymentId) => {
              log("Canceled: " + paymentId);
            },
            onError: (err, payment) => {
              log("Payment error: " + JSON.stringify(err));
            }
          }
        );
      } catch (e) {
        log("Payment exception: " + e.message);
      }
    }
  </script>
</body>
</html>
